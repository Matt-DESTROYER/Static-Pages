// Copyright Matthew James, 2021
class PolygonMesh{constructor(t){this.lines=[],this.maxX=0;for(let i=0;i<t.length-1;i++)this.maxX+=Math.abs(t[i].x),this.maxX+=Math.abs(t[i+1].x),this.lines.push(new Line(t[i],t[i+1]));this.lines.push(new Line(t[t.length-1],t[0])),this.maxX*=10}changeX(t){this.lines.map(i=>{i.x1+=t,i.x2+=t,i.point1.x+=t,i.point2.x+=t}),this.maxX+=t}changeY(t){this.lines.map(i=>{i.y1+=t,i.y2+=t,i.point1.y+=t,i.point2.y+=t})}move(t,i){this.changeX(t),this.changeY(i)}getMidpoint(){let t=new Vector2(0,0);return this.lines.forEach(i=>t.add(i.point1)),t.x/=this.lines.length,t.y/=this.lines.length,t}resetMesh(){let t=this.getMidpoint();this.move(-t.x,-t.y)}rotate(t){let i=this.getMidpoint();this.changeX(-i.x),this.changeY(-i.y),this.lines.forEach(i=>{let e=i.x1,s=i.y1;i.x1=e*Math.cos(t)-s*Math.sin(t),i.y1=e*Math.sin(t)+s*Math.cos(t),this.maxX=Math.max(this.maxX,i.x1),e=i.x2,s=i.y2,i.x2=e*Math.cos(t)-s*Math.sin(t),i.y2=e*Math.sin(t)+s*Math.cos(t),this.maxX=Math.max(this.maxX,i.x2)}),this.changeX(i.x),this.changeY(i.y)}pointInPolygon(t){let i=new Line(t,new Vector2(10*this.maxX,t.y)),e=!1;return this.lines.forEach(t=>e=t.intersects(i)?!e:e),e}collision(t){for(let i=0;i<this.lines.length;i++)if(t.pointInPolygon(new Vector2(this.lines[i].x1,this.lines[i].y1)))return!0;for(let i=0;i<t.lines.length;i++)if(this.pointInPolygon(new Vector2(t.lines[i].x1,t.lines[i].y1)))return!0;return!1}render(t){ctx.fillStyle=t,ctx.beginPath(),ctx.moveTo(this.lines[0].x1,this.lines[0].y1),this.lines.forEach(t=>ctx.lineTo(t.x2,t.y2)),ctx.lineTo(this.lines[0].x1,this.lines[0].y1),ctx.fill(),ctx.closePath()}}